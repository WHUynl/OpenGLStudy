# 面剔除

如果我们想象任何一个闭合形状，它的每一个面都有两侧，每一侧要么**面向**用户，要么背对用户。如果我们能够只绘制**面向**观察者的面呢？

这正是面**剔除(Face Culling)**所做的。OpenGL能够检查所有**面向(Front Facing)**观察者的面，并渲染它们，而丢弃那些**背向(Back Facing)**的面，节省我们很多的片段着色器调用（它们的开销很大！）。但我们仍要告诉OpenGL哪些面是**正向面(Front Face)**，哪些面是**背向面(Back Face)**。OpenGL使用了一个很聪明的技巧，分析顶点数据的**环绕顺序(Winding Order)**。

## 环绕顺序

![image-20210423160045451](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20210423160045451.png)

```c++
float vertices[] = {
    // 顺时针
    vertices[0], // 顶点1
    vertices[1], // 顶点2
    vertices[2], // 顶点3
    // 逆时针
    vertices[0], // 顶点1
    vertices[2], // 顶点3
    vertices[1]  // 顶点2  
};
```

当你定义顶点顺序的时候，你应该想象对应的三角形是面向你的，所以你定义的三角形从正面看去应该是逆时针的。这样定义顶点很棒的一点是,<font color=red>实际的环绕顺序是在光栅化阶段进行的，也就是顶点着色器运行之后。</font>(**故可以减少片段着色器的工作！**)这些顶点就是从**观察者视角**所见的了。

观察者所面向的所有三角形顶点就是我们所指定的正确环绕顺序了，而立方体另一面的三角形顶点则是以相反的环绕顺序所渲染的。这样的结果就是，我们所面向的三角形将会是正向三角形，而背面的三角形则是背向三角形。下面这张图显示了这个效果：

![image-20210423160344643](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20210423160344643.png)

在顶点数据中，我们将两个三角形都以逆时针顺序定义（正面的三角形是1、2、3，背面的三角形也是1、2、3（如果我们从正面看这个三角形的话））。然而，如果从观察者当前视角使用1、2、3的顺序来绘制的话，从观察者的方向来看，背面的三角形将会是以顺时针顺序渲染的。虽然背面的三角形是以逆时针定义的，它现在是以顺时针顺序渲染的了。这正是我们想要**剔除（Cull，丢弃）**的不可见面了！

在顶点数据中，我们定义的是两个逆时针顺序的三角形。然而，从观察者的方面看，后面的三角形是顺时针的，如果我们仍以1、2、3的顺序以观察者当面的视野看的话。即使我们以逆时针顺序定义后面的三角形，它现在还是变为顺时针。它正是我们打算剔除（丢弃）的不可见的面！

**PS:总体来说，每一面的三角形渲染方向，在观察者以该面为主视角的时候，都是逆时针渲染的。所以，当一个正面是逆时针渲染时，其背面必然是顺时针渲染。**

## 面剔除

OpenGL能够丢弃那些渲染为背向三角形的三角形图元。

```c++
//要想启用面剔除，我们只需要启用OpenGL的GL_CULL_FACE选项：
glEnable(GL_CULL_FACE);
/*OpenGL允许我们改变需要剔除的面的类型。如果我们只想剔除正向面而不是背向面会怎么样？我们可以调用glCullFace来定义这一行为：*/
glCullFace(GL_FRONT);
```

![image-20210423161749890](C:\Users\HP\AppData\Roaming\Typora\typora-user-images\image-20210423161749890.png)

**glCullFace**的初始值是GL_BACK。除了需要剔除的面之外，我们也可以通过调用**glFrontFace**，告诉OpenGL我们希望将顺时针的面（而不是逆时针的面）定义为正向面：

```c++
//默认值是GL_CCW，它代表的是逆时针的环绕顺序，另一个选项是GL_CW，它（显然）代表的是顺时针顺序。
glFrontFace(GL_CCW);
```

我们可以来做一个实验，告诉OpenGL现在顺时针顺序代表的是正向面：

```c++
//这样的结果是只有背向面被渲染了(每个面的三角形均为逆时针渲染)
glEnable(GL_CULL_FACE);
glCullFace(GL_BACK);
glFrontFace(GL_CW);
```

